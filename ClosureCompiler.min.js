/*
 ClosureCompiler.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ClosureCompiler.js for details
*/
(function(){function c(b){this.options="object"==typeof b?b:{}}if("undefined"!=typeof window&&window.window||"function"!=typeof require)throw Error("ClosureCompiler.js can only be used within node.js");var f=require("path"),l=require("fs"),n=require("child_process");l.existsSync||(l.existsSync=f.existsSync);c.b=function(b,c,f){if(0>f.indexOf(c))throw"Illegal "+b+" value: "+c+" ("+f+" expected)";};c.JAVA_EXT="win32"==process.platform?".exe":"";c.getGlobalJava=function(){var b=null;process.env.JAVA_HOME&&
(b=process.env.JAVA_HOME+f.sep+"bin"+f.sep+"java"+c.JAVA_EXT,l.existsSync(b)||(b=null));b||(b="java");return b};c.getBundledJava=function(){return f.normalize(__dirname+f.sep+"jre"+f.sep+"bin"+f.sep+"java"+c.JAVA_EXT)};c.testJava=function(b,c){n.exec('"'+b+'" -version',{},function(b,f,d){0<=(""+d).indexOf('version "')?c(!0,null):c(!1,b)})};c.compile=function(b,f,l){(new c(f)).compile(b,l)};c.prototype.compile=function(b,p){function n(a,b){require("child_process").exec(a,{c:20971520},b)}function q(a,
b){n('"'+a+'" '+b,function(a,b,c){0<b.length||0<c.length?p(c+"",b+""):p(a,null)})}for(var d={},h=Object.keys(this.options),a=0;a<h.length;a++)d[h[a].toLowerCase()]=this.options[h[a]];delete d.js;delete d.js_output_file;var k='-jar "'+__dirname+'/compiler/compiler.jar"';b instanceof Array||(b=[b]);for(a=0;a<b.length;a++){if("string"!=typeof b[a]||0<=b[a].indexOf('"'))throw Error("Illegal source file: "+b[a]);e=l.statSync(b[a]);if(!e.isFile())throw Error("Source file not found: "+b[a]);k+=' --js "'+
b[a]+'"'}d.a||(d.a=[]);d.a instanceof Array||(d.a=[d.a]);for(var h=[],e,a=0;a<d.a.length;a++){if("string"!=typeof d.a[a]||""==d.a[a])throw Error("Externs directive does not point to a file or directory: "+d.a[a]);"node"==d.a[a].toLowerCase()&&(d.a[a]=__dirname+"/node_modules/closurecompiler-externs");e=l.statSync(d.a[a]);if(e.isDirectory()){var m=l.readdirSync(d.a[a]);for(e=0;e<m.length;e++){var g=d.a[a]+"/"+m[e];l.statSync(g).isFile()&&".js"==f.extname(g).toLowerCase()&&h.push(g)}}else if(e.isFile())h.push(d.a[a]);
else throw Error("Externs file not found: "+d.a[a]);}delete d.externs;for(a=0;a<h.length;a++)k+=' --externs "'+h[a]+'"';h=Object.keys(d);for(a=0;a<h.length;a++){m=h[a];g=d[h[a]];if(!/[a-zA-Z0-9_]+/.test(m))throw Error("Illegal option: "+m);if(!0===g)k+=" --"+m;else if(!1!==g){g instanceof Array||(g=[g]);for(e=0;e<g.length;e++){if(!/[^\s]*/.test(g[e]))throw Error("Illegal value for option "+m+": "+g[e]);k+=" --"+m+" "+g[e]}}}c.testJava(c.getGlobalJava(),function(a){a?q(c.getGlobalJava(),k):c.testJava(c.getBundledJava(),
function(a){if(a)q(c.getBundledJava(),k);else throw Error("Java is not available, neither the bundled nor a global one.");})})};c.prototype.toString=function(){return"ClosureCompiler"};module.exports=c})(this);
