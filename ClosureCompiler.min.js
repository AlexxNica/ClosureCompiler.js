/*
 ClosureCompiler.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ClosureCompiler.js for details
*/
(function(){function c(b){this.options="object"==typeof b?b:{}}if("undefined"!=typeof window&&window.window||"function"!=typeof require)throw Error("ClosureCompiler.js can only be used within node.js");var e=require("path"),m=require("fs"),n=require("child_process");c.b=function(b,c,e){if(0>e.indexOf(c))throw"Illegal "+b+" value: "+c+" ("+e+" expected)";};c.JAVA_EXT="win32"==process.platform?".exe":"";c.getGlobalJava=function(){var b=null;process.env.JAVA_HOME&&(b=process.env.JAVA_HOME+e.sep+"bin"+
e.sep+"java"+c.JAVA_EXT,m.existsSync(b)||(b=null));b||(b="java");return b};c.getBundledJava=function(){return e.normalize(__dirname+e.sep+"jre"+e.sep+"bin"+e.sep+"java"+c.JAVA_EXT)};c.testJava=function(b,c){n.exec('"'+b+'" -version',{},function(b,e,d){0<=(""+d).indexOf('version "')?c(!0):c(!1)})};c.compile=function(b,e,m){(new c(e)).compile(b,m)};c.prototype.compile=function(b,p){function n(a,b){require("child_process").exec(a,{c:20971520},b)}function q(a,b){n('"'+a+'" '+b,function(a,b,c){0<b.length||
0<c.length?p(c+"",b+""):p(a,null)})}for(var d={},g=Object.keys(this.options),a=0;a<g.length;a++)d[g[a].toLowerCase()]=this.options[g[a]];delete d.js;delete d.js_output_file;var k='-jar "'+__dirname+'/compiler/compiler.jar"';b instanceof Array||(b=[b]);for(a=0;a<b.length;a++){if("string"!=typeof b[a]||0<=b[a].indexOf('"'))throw Error("Illegal source file: "+b[a]);h=m.statSync(b[a]);if(!h.isFile())throw Error("Source file not found: "+b[a]);k+=' --js "'+b[a]+'"'}d.a||(d.a=[]);d.a instanceof Array||
(d.a=[d.a]);for(var g=[],h,a=0;a<d.a.length;a++){if("string"!=typeof d.a[a]||""==d.a[a])throw Error("Externs directive does not point to a file or directory: "+d.a[a]);"node"==d.a[a].toLowerCase()&&(d.a[a]=__dirname+"/node_modules/closurecompiler-externs");h=m.statSync(d.a[a]);if(h.isDirectory()){var l=m.readdirSync(d.a[a]);for(h=0;h<l.length;h++){var f=d.a[a]+"/"+l[h];m.statSync(f).isFile()&&".js"==e.extname(f).toLowerCase()&&g.push(f)}}else if(h.isFile())g.push(d.a[a]);else throw Error("Externs file not found: "+
d.a[a]);}delete d.externs;for(a=0;a<g.length;a++)k+=' --externs "'+g[a]+'"';g=Object.keys(d);for(a=0;a<g.length;a++){l=g[a];f=d[g[a]];if(!/[a-zA-Z0-9_]+/.test(l))throw Error("Illegal option: "+l);if(!0===f)k+=" --"+l;else if(!1!==f){f instanceof Array||(f=[f]);for(h=0;h<f.length;h++){if(!/[^\s]*/.test(f))throw Error("Illegal value for option "+l+": "+f);k+=" --"+l+" "+f}}}c.testJava(c.getGlobalJava(),function(a){a?q(c.getGlobalJava(),k):c.testJava(c.getBundledJava(),function(a){if(a)q(c.getBundledJava(),
k);else throw Error("Java is not available, neither the bundled nor a global one.");})})};c.prototype.toString=function(){return"ClosureCompiler"};module.exports=c})(this);
