/*
 ClosureCompiler.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ClosureCompiler.js for details
*/
(function(){function d(){}if("undefined"!=typeof window&&window.window||"function"!=typeof require)throw Error("ClosureCompiler.js can only be used within node.js");var h=require("path"),l=require("fs"),m=require("child_process");d.b=function(c,a,d){if(0>d.indexOf(a))throw"Illegal "+c+" value: "+a+" ("+d+" expected)";};d.JAVA_EXT="win32"==process.platform?".exe":"";d.getGlobalJava=function(){var c=null;process.env.JAVA_HOME&&(c=process.env.JAVA_HOME+h.sep+"bin"+h.sep+"java"+d.JAVA_EXT,l.existsSync(c)||
(c=null));c||(c="java");return c};d.getBundledJava=function(){return h.normalize(__dirname+h.sep+"jre"+h.sep+"bin"+h.sep+"java"+d.JAVA_EXT)};d.testJava=function(c,a){m.exec('"'+c+'" -version',{},function(c,d,h){0<=(""+h).indexOf('version "')?a(!0):a(!1)})};d.compile=function(c,a,h){(new d).compile(c,a,h)};d.prototype.compile=function(c,a,n){function m(b,a){require("child_process").exec(b,{c:20971520},a)}function p(b,a){m('"'+b+'" '+a,function(b,a,c){0<a.length||0<c.length?n(c+"",a+""):n(b,null)})}
a=a||{};for(var e={},g=Object.keys(a),b=0;b<g.length;b++)e[g[b].toLowerCase()]=a[g[b]];a=e;delete a.js;delete a.js_output_file;var k='-jar "'+__dirname+'/compiler/compiler.jar"';c instanceof Array||(c=[c]);for(b=0;b<c.length;b++){if("string"!=typeof c[b]||0<=c[b].indexOf('"'))throw Error("Illegal source file: "+c[b]);e=l.statSync(c[b]);if(!e.isFile())throw Error("Source file not found: "+c[b]);k+=' --js "'+c[b]+'"'}a.a||(a.a=[]);a.a instanceof Array||(a.a=[a.a]);g=[];for(b=0;b<a.a.length;b++){if("string"!=
typeof a.a[b]||""==a.a[b])throw Error("Externs directive does not point to a file or directory: "+a.a[b]);"node"==a.a[b].toLowerCase()&&(a.a[b]=__dirname+"/node_modules/closurecompiler-externs");e=l.statSync(a.a[b]);if(e.isDirectory()){e=l.readdirSync(a.a[b]);for(c=0;c<e.length;c++){var f=a.a[b]+"/"+e[c];l.statSync(f).isFile()&&".js"==h.extname(f).toLowerCase()&&g.push(f)}}else if(e.isFile())g.push(a.a[b]);else throw Error("Externs file not found: "+a.a[b]);}delete a.externs;for(b=0;b<g.length;b++)k+=
' --externs "'+g[b]+'"';g=Object.keys(a);for(b=0;b<g.length;b++){e=g[b];f=a[g[b]];if(!/[a-zA-Z0-9_]+/.test(e))throw Error("Illegal option: "+e);if(!0===f)k+=" --"+e;else if(!1!==f){f instanceof Array||(f=[f]);for(c=0;c<f.length;c++){if(!/[^\s]*/.test(f))throw Error("Illegal value for option "+e+": "+f);k+=" --"+e+" "+f}}}d.testJava(d.getGlobalJava(),function(a){a?p(d.getGlobalJava(),k):d.testJava(d.getBundledJava(),function(a){if(a)p(d.getBundledJava(),k);else throw Error("Java is not available, neither the bundled nor a global one.");
})})};d.prototype.toString=function(){return"ClosureCompiler"};module.exports=d})(this);
