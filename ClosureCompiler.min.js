/*
 ClosureCompiler.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ClosureCompiler.js for details
*/
(function(){function d(c){this.options="object"===typeof c&&c?c:{}}if("undefined"!=typeof window&&window.window||"function"!=typeof require)throw Error("ClosureCompiler.js can only be used within node.js");var n=require("path"),k=require("fs"),r=require("child_process");k.existsSync||(k.existsSync=n.existsSync);d.b=function(c,d,m){if(0>m.indexOf(d))throw"Illegal "+c+" value: "+d+" ("+m+" expected)";};d.JAVA_EXT="win32"==process.platform?".exe":"";d.getGlobalJava=function(){var c=null;process.env.JAVA_HOME&&
(c=n.join(process.env.JAVA_HOME,"bin","java"+d.JAVA_EXT),k.existsSync(c)||(c=null));c||(c="java");return c};d.getBundledJava=function(){return n.normalize(n.join(__dirname,"jre","bin","java"+d.JAVA_EXT))};d.testJava=function(c,d){r.exec('"'+c+'" -version',{},function(c,k,b){b+="";b.match(/1\.[7-8]+/)?d(!0,null):0<=b.indexOf('version "')?d(!1,Error("Not Java 7")):d(!1,c)})};d.compile=function(c,k,m){(new d(k)).compile(c,m)};d.prototype.compile=function(c,p){function m(a,b){require("child_process").exec(a,
{c:20971520},b)}function q(a,b){m('"'+a+'" '+b,function(a,b,c){0<b.length||0<c.length?p(c+"",b+""):p(a,null)})}for(var b={},h=Object.keys(this.options),a=0;a<h.length;a++)b[h[a].toLowerCase()]=this.options[h[a]];delete b.js;delete b.js_output_file;var a=b.Xms||null,e=b.Xmx||"1024m";delete b.Xms;delete b.Xmx;var f="-XX:+TieredCompilation";a&&(f+=" -Xms"+a);f+=" -Xmx"+e;f+=' -jar "'+__dirname+'/compiler/compiler.jar"';c instanceof Array||(c=[c]);for(a=0;a<c.length;a++){if("string"!=typeof c[a]||0<=
c[a].indexOf('"'))throw Error("Illegal source file: "+c[a]);e=k.statSync(c[a]);if(!e.isFile())throw Error("Source file not found: "+c[a]);f+=' --js "'+c[a]+'"'}b.a||(b.a=[]);b.a instanceof Array||(b.a=[b.a]);h=[];for(a=0;a<b.a.length;a++){if("string"!=typeof b.a[a]||""==b.a[a])throw Error("Externs directive does not point to a file or directory: "+b.a[a]);"node"==b.a[a].toLowerCase()&&(b.a[a]=__dirname+"/node_modules/closurecompiler-externs");e=k.statSync(b.a[a]);if(e.isDirectory())for(var l=k.readdirSync(b.a[a]),
e=0;e<l.length;e++){var g=b.a[a]+"/"+l[e];k.statSync(g).isFile()&&".js"==n.extname(g).toLowerCase()&&h.push(g)}else if(e.isFile())h.push(b.a[a]);else throw Error("Externs file not found: "+b.a[a]);}delete b.externs;for(a=0;a<h.length;a++)f+=' --externs "'+h[a]+'"';h=Object.keys(b);for(a=0;a<h.length;a++){l=h[a];g=b[h[a]];if(!/[a-zA-Z0-9_]+/.test(l))throw Error("Illegal option: "+l);if(!0===g)f+=" --"+l;else if(!1!==g)for(g instanceof Array||(g=[g]),e=0;e<g.length;e++){if(!/[^\s]*/.test(g[e]))throw Error("Illegal value for option "+
l+": "+g[e]);f+=" --"+l+" "+g[e]}}d.testJava(d.getGlobalJava(),function(a){a?q(d.getGlobalJava(),f):d.testJava(d.getBundledJava(),function(a){if(a)q(d.getBundledJava(),f);else throw Error("Java is not available, neither the bundled nor a global one.");})})};d.prototype.toString=function(){return"ClosureCompiler"};module.exports=d})(this);
